# 第一章 环境搭建

## 关于Odoo

笔者接触odoo已经有四五年的时间了，从最初的OpenERP 7到现在的odoo 12，中间有过一段时间的远离，现在机缘巧合下又重新出发。Odoo是一个优秀的开源ERP框架，有这诸多的优点，部署简单、开发迅速、可扩展性好，当然一个事物有有点就必定会有缺点，缺点就是语言小众(Python：怪我咯？)，资料奇少，最重要的一点也是最致命的一点就是它真的只是一个框架，虽然有众多的第三方模块加成，但是真的无法做到开箱即用，这也就对它的潜在使用者造成了门楷，看起来美好，像用起来却不得不找专业的公司实施或者招一个懂行的人进行开发。

Odoo的国内市场，目前（2019）有了一个领航人，浪潮集团，可能会对国内的生态带了一些积极的影响。但是就目前的态势来看，浪潮的思路也是做SAAS模式。个人并不看好这种模式，Odoo社区版虽然免费，但实施起来却需要相当的持续的投入，这对企业的长远来说并不算是一个性价比高的选择。笔者曾经供职的一家企业，在2014年开始使用Odoo，后来因为技术的支持不到位（也许有资金层面的原因），现在据说已经退回到金蝶用友的软件了。对于国内一些靠Odoo实施生存的企业来说，个人也持悲观模式，其实Odoo入华已经年头不少了，从6.0（2012）开始国内就有先驱开始做这块的市场，现在7年已经过去了，依旧没有看到一家能够壮大的专业实施公司。这里边需要思考的东西挺多，当官方都吃不饱(甚至跑过来跟代理商抢饭吃)的时候，处在下游的公司就更难说活得美好了。

个人觉得，Odoo最好的使用模式，是公司或者集团内部，由IT团队进行支持开发，然后不断迭代，内化成自己公司的内部一套ERP系统是最合适的。IT团队懂技术，产品团队优化需求，再经过持续迭代和优化，最终能够成为一套不错的解决方案。因为IT团队本身就是需要投入，这样就能将成本摊平，提高软件使用的性价比。本系列教程也是从技术层面出发，希望能多的人能够了解到这套系统的架构，从中学到一些不错的思路，而对于商业化层面的东西，我只能说，偶尔兼个职也是不错的。

## 环境的搭建

Odoo的环境搭建方式多种多样，按方式划分的话可以分为源码安装和安装包安装两种方式。 源码安装的方式相对比较繁琐，适合于喜欢自己动手同学。安装包安装的方式比较简洁，适合于喜欢傻瓜式安装软件的同学。两种方式没有优劣之分，取决于你的心情。下面简单介绍一下这两种安装方式。(因为windows的使用场景比较少，本书所有的开发和部署场景均是在Linux下完成，喜欢使用windows和mac的同学可以到网络上搜索相关的内容，完成安装后继续阅读)

### 数据库的安装

Odoo使用的是Postgresql，我们在正式开始安装之前需要先安装好数据库。使用安装包安装的同学可以跳过这一部分，因为安装包通常会自动把数据库安装好。

> 本书的环境基于ubuntu，使用centos的同学可以根据centos的命令自行替换。

1. 安装postgresql:
```sh
apt-get install postgresql
```
2. 数据库安装完成后，需要配置odoo用户:
```
sudo su postgres
psql
create user odoo with superuser
```
3. 开启监听模式，默认情况下Postgresql只允许本地访问，因此我们需要将该条件放开。找到/etc/postgres/9.x/main/postgresql.conf，将listen_addresses改为*:
```
listen_address="*"
```
4. 编辑/etc/postgres/9.x/main/pg_hba.conf文件，针对不同的IP号段设置不同的访问权限，peer,md5,trust


### 源码安装

1. 使用git将odoo的源码克隆到本地，注意选择你要安装的版本分支。
   
```sh
git clone https://github.com/odoo/odoo
```

2. 代码下载下来之后，进入文件夹使用如下命令进行安装，由于GFW的原因，很多插件自动安装不上，需要手动安装，这也是源码安装最为繁琐的地方。
   
```sh
python setup.py install
```
3. 所有插件安装完成后，即可使用如下的命令启动:
   
```python
./odoo -r odoo --addons-path='./addons'
```

### 安装包安装

安装包安装相对要省心很多，以ubuntu为例

1. 添加odoo的官方源：
```
deb http://nightly.odoo.com/12.0/nightly/deb/ ./
```

2. 更新源列表
```python
apt-get udpate
```
此过程中可能碰到key验证失败的问题，可到https://nightly.odoo.com/odoo.key 下载公用key，然后使用sudo apt-key add命令添加key:
```sh
apt-key add odoo.key
```

3. 使用apt-get方式安装
```sh
apt-get install odoo
```

> 由于国内复杂的网络情况，不排除有些地区的下载速度会非常缓慢，这个时候你需要的是耐心。


到这一步，读者应该已经搭建起来了odoo的环境，下一章我们将正式开始我们的开发旅程。